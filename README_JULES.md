# JULES Agent

## Purpose and Architecture Overview

`agents/jules` provides a modular agent for orchestrating LLM tasks, including scraping web content, parsing Qodo comments for feedback, and emitting detailed provenance events. It is designed to integrate seamlessly with CI/CD pipelines, particularly GitHub Actions, to support robust artifact and data lineage.

The system is composed of several key components:
- **Jules Utilities (`agents/jules/`)**: A collection of helper modules for common tasks like I/O operations, schema validation, and interacting with the DeepSeek API.
- **Provenance Emitter (`agents/provenance.py`)**: The core module responsible for creating, validating, and emitting provenance events.
- **CLI Scripts (`scripts/`)**: A set of command-line tools for triggering the scraping and Qodo parsing workflows.
- **GitHub Workflows (`.github/workflows/`)**: Automation pipelines that are triggered by issue comments to run the CLI scripts.
- **Provenance Storage (`.github/PROVENANCE/`)**: The directory where the emitted provenance bundles are stored as JSON files.

## File Locations and Responsibilities

- **`agents/jules/`**: Contains all the core logic and utilities for the Jules agent.
  - `__init__.py`: Package marker.
  - `deepseek_proxy.py`: A proxy for querying the DeepSeek API.
  - `io_utils.py`: Utilities for atomic file writing and hashing.
  - `qodo_reader.py`: Logic for parsing Qodo comments.
  - `schema_validator.py`: A module for validating provenance events against the official JSON schema.
- **`agents/provenance.py`**: The main interface for emitting provenance events.
- **`search/deepseekadapter.py`**: An adapter for interacting with the DeepSeek service.
- **`scripts/`**: Contains the entry-point scripts for the workflows.
  - `scrapeandemit.py`: Fetches a URL, queries the DeepSeek API, and emits a provenance event.
  - `parseqodoand_emit.py`: Parses Qodo comments from a pull request and emits a provenance event.
- **`.github/PROVENANCE/`**: The output directory for all emitted provenance bundles.
- **`.github/workflows/`**: Contains the GitHub Actions workflows.
  - `deepseek_scrape.yml`: A workflow for scraping web content.
  - `qodo_feedback.yml`: A workflow for parsing Qodo feedback.
- **`tests/`**: Contains the unit tests for the new modules.

## How to Run Locally

To run the scripts locally, you will need to set up your environment and provide the necessary API keys and tokens.

1.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **Set up environment variables:**
    Create a `.env` file in the root of the repository and add the following variables:
    ```
    SCRAPEDO_API_KEY="your_scrapedo_api_key"
    DEEPSEEK_URL="your_deepseek_api_url"
    GITHUB_TOKEN="your_github_personal_access_token"
    GH_PAT="your_github_personal_access_token"
    ```
    Then, load the environment variables:
    ```bash
    export $(cat .env | xargs)
    ```

3.  **Run the scripts:**
    You can now run the scripts with the `--dry-run` flag to test them without emitting any provenance events.

    *   **Parse Qodo feedback:**
        ```bash
        python scripts/parseqodoand_emit.py --repo "owner/repo" --pr 123 --dry-run
        ```

    *   **Scrape a URL:**
        ```bash
        python scripts/scrapeandemit.py --url "https://example.com" --claimid "issue-1" --dry-run
        ```

## Jules's Behavior and Safety Notes

- **Jules can make mistakes**: The code generated and modified by Jules should always be thoroughly reviewed by a human.
- **Double-check outputs**: The provenance bundles generated by the system should be reviewed to ensure they contain the expected information and that no sensitive data has been leaked.
- **Security**: The GitHub Actions workflows have been configured to use SHA-pinned actions to mitigate the risk of supply chain attacks. Ensure that any future changes to these workflows continue to follow this best practice.
- **API Keys**: The system is designed to read API keys and tokens from environment variables. Never hardcode these values in the source code.
